name: CI
on:
  push:
    paths-ignore:
      - '**.md'
  pull_request:
    paths-ignore:
      - '**.md'

env:
  NIM_VERSION: 1.6.0


jobs:
  run-nim-compiler-in-docker-contain:
    name: Build image and run nim compiler inside
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@ec3a7ce113134d7a93b817d10a8272cb61118579 # 2.4.0

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@94ab11c41e45d028884a99163086648e898eed25

    - name: Cache Docker layers
      uses: actions/cache@937d24475381cd9c75ae6db12cb4e79714b926ed
      with:
        path: /tmp/.buildx-cache
        key: ${{ runner.os }}-buildx-${{ github.sha }}
        restore-keys: |
          ${{ runner.os }}-buildx-
 
    - name: Build Image
      run: docker build -t "exercism/nim-docker-base:${NIM_VERSION}" .

    - name: Run container with test entrypoint 
      run: docker run --rm --entrypoint /nim/bin/nim "exercism/nim-docker-base:${NIM_VERSION}" r --eval:'import os; echo getFileInfo("/nim/bin/nim")'
